<!DOCTYPE html>
<html> 
  <head> 
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Olah JSON</title>
  </head>
  <body>
    <script>
      "use strict";var data={santri:[{id:1,nama:"Zen",alamat:"Samarinda"},{id:2,nama:"Yani",alamat:"Samarinda"},{id:3,nama:"Anggi",alamat:"Samarinda"}],lomba:[{id:1,lomba:"balap karung",santri_id:1}]};'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var OlahJson = function () {
	function OlahJson(json) {
		_classCallCheck(this, OlahJson);

		this.json = json;
	}

	_createClass(OlahJson, [{
		key: 'query',
		value: function query(querynya) {
			this.querynya = querynya;
			var pisahTanya = this.querynya.split('?');
			var sebelumTanya = pisahTanya[0];
			var setelahTanya = pisahTanya[1];

			// bagian selektor
			var pisahSebelumTanya = sebelumTanya.split('/');
			var judulTable = pisahSebelumTanya[0];
			var kunci = pisahSebelumTanya[1];
			var selektor = eval('this.json.' + judulTable);
			if (kunci) {
				selektor = selektor.filter(function (data) {
					return data.id == kunci;
				});
			}

			if (setelahTanya) {
				// bagian filter
				var pisahDan = setelahTanya.split('&');
				for (var n in pisahDan) {
					pisahDan[n] = pisahDan[n].split('=');
				}
				var _iteratorNormalCompletion = true;
				var _didIteratorError = false;
				var _iteratorError = undefined;

				try {
					for (var _iterator = pisahDan[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
						var x = _step.value;

						if (!x[0].startsWith('_')) {
							// jika nggak diawali dengan _
							// selektor = selektor.filter(data => eval(`data.${x[0]}`) == x[1])
							selektor = selektor.filter(function (data) {
								return eval('data.' + x[0] + '.toString().toLowerCase().includes(\'' + x[1] + '\'.toString().toLowerCase())');
							});
						} else {
							// jika diawali dengan _
							if (x[0] == '_q') {}
						}
					}
				} catch (err) {
					_didIteratorError = true;
					_iteratorError = err;
				} finally {
					try {
						if (!_iteratorNormalCompletion && _iterator.return) {
							_iterator.return();
						}
					} finally {
						if (_didIteratorError) {
							throw _iteratorError;
						}
					}
				}
			}

			// hasilnya
			this.jsonBaru = selektor;
			this.jsonString = JSON.stringify(this.json);

			// ini untuk delete
			this.jsonBaruString = JSON.stringify(this.jsonBaru).substring(1);
			this.jsonBaruString = this.jsonBaruString.substring(0, this.jsonBaruString.length - 1);

			return this;
		}
	}, {
		key: 'get',
		value: function get() {
			// get selesai
			return this.jsonBaru;
		}
	}, {
		key: 'delete',
		value: function _delete() {
			// delete selesai
			this.teksPemotongan = this.jsonString.replace(this.jsonBaruString, '').replace(/,,/g, ',').replace(/,\]/g, ']').replace(/\[,/g, '['); // memperbaiki sintaks json
			this.teksPemotongan = JSON.parse(this.teksPemotongan);
			return this.teksPemotongan;
		}
	}, {
		key: 'put',
		value: function put(dataPut) {
			this.dataPut = dataPut;
			return this.dataPut;
		}
	}, {
		key: 'post',
		value: function post(dataPost) {}
	}]);

	return OlahJson;
}();"use strict";var datanya=new OlahJson(data),hasilOlahan=datanya.query("santri/1").put({nama:"Kucing",alamat:"Balikpapan"});console.log(hasilOlahan);
    </script>
  </body>
</html>